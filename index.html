<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>CA Solar PPA • Learn Mode</title>
  <meta name="theme-color" content="#0b1017"/>

  <style>
    :root{
      --navy:#0b1017;
      --navy2:#06122a;

      --gold:#FBC909;
      --teal:#3AADBB;
      --lime:#86f7a6;

      --text:rgba(255,255,255,.94);
      --muted:rgba(255,255,255,.70);
      --muted2:rgba(255,255,255,.56);

      --stroke: rgba(255,255,255,.10);
      --shadow: 0 18px 70px rgba(0,0,0,.45);

      --r:18px;
      --r2:28px;

      --safeT: env(safe-area-inset-top);
      --safeB: env(safe-area-inset-bottom);
      --safeL: env(safe-area-inset-left);
      --safeR: env(safe-area-inset-right);

      --grad: linear-gradient(135deg, rgba(251,201,9,.22), rgba(58,173,187,.18));
      --glass: rgba(15,23,36,.62);
      --glass2: rgba(0,0,0,.18);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1100px 700px at 20% -10%, rgba(251,201,9,.18), transparent 60%),
        radial-gradient(900px 600px at 110% 10%, rgba(58,173,187,.18), transparent 55%),
        linear-gradient(180deg, var(--navy), var(--navy2));
      color: var(--text);
      padding: calc(14px + var(--safeT)) calc(14px + var(--safeR)) calc(16px + var(--safeB)) calc(14px + var(--safeL));
    }

    .wrap{ max-width: 980px; margin: 0 auto; }

    /* Top Bar */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border:1px solid var(--stroke);
      border-radius: var(--r2);
      background: rgba(15,23,36,.55);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .logo{
      width:42px; height:42px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      overflow:hidden;
      display:grid; place-items:center;
      flex:0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; }
    .titleWrap{ min-width:0; }
    .appTitle{
      margin:0;
      font-size: 15px;
      letter-spacing: .2px;
      line-height: 1.15;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .appSub{
      margin: 5px 0 0 0;
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .right{
      display:flex;
      align-items:center;
      gap:8px;
      flex:0 0 auto;
    }
    .pill{
      font-size:12px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      white-space:nowrap;
    }
    .pill b{
      background: linear-gradient(135deg, var(--gold), var(--teal));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
    }
    .iconBtn{
      width:40px; height:40px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.88);
      cursor:pointer;
      display:grid;
      place-items:center;
      user-select:none;
    }
    .iconBtn:active{ transform: scale(.98); }

    /* Learn Card */
    .stage{
      margin-top: 14px;
      border-radius: var(--r2);
      border:1px solid var(--stroke);
      background: rgba(15,23,36,.55);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .card{
      min-height: calc(88vh - 70px);
      padding: 22px 18px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap: 18px;
      touch-action: pan-y;
      user-select:none;
    }

    .topRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-size: 13px;
    }
    .progress{
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .dots{
      display:flex;
      gap:6px;
      align-items:center;
    }
    .dot{
      width:7px;height:7px;border-radius:999px;
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.10);
    }
    .dot.on{
      background: rgba(251,201,9,.90);
      border-color: rgba(251,201,9,.35);
      box-shadow: 0 0 0 4px rgba(251,201,9,.12);
    }

    .qTitle{
      font-size: 26px;
      line-height: 1.25;
      text-align:center;
      margin: 0;
      letter-spacing: .2px;
      padding: 0 6px;
    }

    .say{
      border-radius: 24px;
      padding: 18px 16px;
      border:1px solid rgba(251,201,9,.22);
      background: linear-gradient(135deg, rgba(251,201,9,.22), rgba(251,201,9,.06));
    }
    .label{
      font-size: 12px;
      letter-spacing: .4px;
      text-transform: uppercase;
      color: rgba(255,255,255,.74);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .label .chipDot{
      width:10px;height:10px;border-radius:999px;
      background: rgba(251,201,9,.95);
      box-shadow: 0 0 0 4px rgba(251,201,9,.12);
    }
    .say p{
      margin: 10px 0 0 0;
      font-size: 19px;
      line-height: 1.6;
      color: rgba(255,255,255,.94);
    }

    .actions{
      display:grid;
      gap: 10px;
    }
    .btn{
      width:100%;
      padding: 16px 14px;
      font-size: 17px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      text-align:left;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .btn:active{ transform: scale(.99); }
    .btn .hint{
      font-size: 13px;
      color: var(--muted2);
    }
    .btn.teal{
      border-color: rgba(58,173,187,.22);
      background: linear-gradient(135deg, rgba(58,173,187,.18), rgba(58,173,187,.06));
    }
    .btn.gray{
      background: rgba(0,0,0,.18);
    }

    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding-top: 6px;
    }
    .navBtn{
      flex:1;
      padding: 14px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.90);
      cursor:pointer;
      font-size: 16px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
    }
    .navBtn.primary{
      border-color: rgba(251,201,9,.22);
      background: var(--grad);
      color: rgba(255,255,255,.96);
      font-weight: 650;
    }
    .navBtn:disabled{
      opacity: .45;
      cursor:not-allowed;
    }

    .footerHint{
      text-align:center;
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.35;
      padding: 10px 14px 14px 14px;
      border-top: 1px solid rgba(255,255,255,.08);
    }

    /* Slide animation */
    .animOutLeft{ animation: outLeft .18s ease both; }
    .animInRight{ animation: inRight .20s ease both; }
    .animOutRight{ animation: outRight .18s ease both; }
    .animInLeft{ animation: inLeft .20s ease both; }

    @keyframes outLeft{ to{ transform: translateX(-18px); opacity:.0; } }
    @keyframes inRight{ from{ transform: translateX(18px); opacity:.0; } to{ transform: translateX(0); opacity:1; } }
    @keyframes outRight{ to{ transform: translateX(18px); opacity:.0; } }
    @keyframes inLeft{ from{ transform: translateX(-18px); opacity:.0; } to{ transform: translateX(0); opacity:1; } }

    /* Bottom Sheet */
    .sheetBack{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 14px;
      z-index:50;
    }
    .sheet{
      width: min(980px, 100%);
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,23,36,.86);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(12px);
      opacity: 0;
      transition: transform .18s ease, opacity .18s ease;
    }
    .sheetBack.show{ display:flex; }
    .sheetBack.show .sheet{
      transform: translateY(0);
      opacity: 1;
    }
    .sheetHead{
      padding: 14px 14px 10px 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .sheetTitle{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .sheetClose{
      width:40px;height:40px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      display:grid; place-items:center;
      user-select:none;
      flex:0 0 auto;
    }
    .sheetBody{
      padding: 12px 14px 16px 14px;
      color: rgba(255,255,255,.86);
      line-height: 1.55;
      font-size: 16px;
    }
    .bullets{
      margin: 10px 0 0 0;
      padding-left: 18px;
      color: rgba(255,255,255,.84);
    }
    .bullets li{ margin: 8px 0; }
    .tagRow{
      padding: 10px 14px 14px 14px;
      border-top: 1px solid rgba(255,255,255,.10);
      color: var(--muted2);
      font-size: 12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    /* Tiny helper */
    .kbd{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 22px;
      padding: 2px 7px;
      border-radius: 10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      color: rgba(255,255,255,.72);
      font-size: 12px;
    }
  </style>
</head>

<body>
<div class="wrap">

  <header>
    <div class="brand">
      <div class="logo" title="L.O.S.">
        <img src="los-logo.png" alt="LOS Logo"
          onerror="this.style.display='none'; this.parentElement.textContent='LOS'; this.parentElement.style.fontWeight='800'; this.parentElement.style.color='rgba(255,255,255,.9)';">
      </div>
      <div class="titleWrap">
        <p class="appTitle">CA Solar PPA • Learn Mode</p>
        <p class="appSub">Swipe to learn • Tap to reveal why/verify</p>
      </div>
    </div>

    <div class="right">
      <div class="pill"><b>Apple</b> style</div>
      <button class="iconBtn" id="helpBtn" title="Help">?</button>
    </div>
  </header>

  <section class="stage">
    <div class="card" id="card">
      <!-- Injected by JS -->
    </div>
    <div class="footerHint">
      Swipe <span class="kbd">←</span> <span class="kbd">→</span> to move • Tap “Why this works” + “Verify in contract” when needed.
    </div>
  </section>
</div>

<!-- Bottom Sheet -->
<div class="sheetBack" id="sheetBack" aria-hidden="true">
  <div class="sheet" role="dialog" aria-modal="true">
    <div class="sheetHead">
      <div>
        <h3 class="sheetTitle" id="sheetTitle">Title</h3>
        <div style="margin-top:6px;color:var(--muted);font-size:12px" id="sheetSub"></div>
      </div>
      <button class="sheetClose" id="sheetClose" aria-label="Close">✕</button>
    </div>
    <div class="sheetBody" id="sheetBody"></div>
    <div class="tagRow" id="sheetTagRow">
      <span id="sheetTagLeft"></span>
      <span id="sheetTagRight"></span>
    </div>
  </div>
</div>

<script>
/* =========================
   Learn Deck Data (edit here)
   ========================= */
const DECK = [
  {
    tag: "Basics",
    q: "What is a Solar PPA?",
    say: "You’re not buying panels.\nYou’re buying the power they produce at an agreed rate.",
    why: "It removes the biggest confusion (ownership vs loan) so they can compare options clearly.",
    verify: [
      "System ownership (provider owns equipment)",
      "Your starting kWh price",
      "Escalator (0% or %/yr) in writing"
    ]
  },
  {
    tag: "Price",
    q: "How do I pay on a PPA — is it a fixed bill?",
    say: "You pay per kWh the system produces.\nSeasonal production changes, so monthly cost can vary.",
    why: "It prevents “I thought it was fixed” frustration — and builds trust early.",
    verify: [
      "Billing method (kWh produced)",
      "Any minimum charge language",
      "How credits/true-up are handled (if applicable)"
    ]
  },
  {
    tag: "Escalator",
    q: "What is an escalator (0% vs escalator)?",
    say: "An escalator is the annual increase on your solar kWh price.\n0% costs more today but stays flatter long-term.",
    why: "This is the money lever. Clarity here prevents regret later.",
    verify: [
      "Exact escalator % and when it starts",
      "Does it apply to all kWh",
      "Any cap (if stated)"
    ]
  },
  {
    tag: "Compare",
    q: "How do we compare this to Edison?",
    say: "We compare price per kWh.\nIf solar kWh is lower and sized right, you save—especially during expensive hours.",
    why: "Monthly bills confuse people. kWh price makes it simple and fair.",
    verify: [
      "Solar kWh price + escalator",
      "Utility charges that still remain",
      "System size / expected production"
    ]
  },
  {
    tag: "Term",
    q: "How long is the agreement and what happens at the end?",
    say: "Most PPAs are long-term.\nAt the end, you typically renew, buy, or remove—based on the contract.",
    why: "End-of-term uncertainty is a silent deal killer. Give them control with clarity.",
    verify: [
      "Term length",
      "End-of-term options (renew/buy/remove)",
      "Removal responsibilities"
    ]
  },
  {
    tag: "Buyout",
    q: "Is there a buyout option?",
    say: "Many PPAs have a buyout option at certain years.\nWe’ll show you the buyout rules in writing.",
    why: "Buyout clarity = homeowner feels in control (especially if they may sell later).",
    verify: [
      "Buyout timing windows",
      "Price method (schedule vs fair market value)",
      "Any admin/transfer fees"
    ]
  },
  {
    tag: "Selling",
    q: "What happens if I sell the home?",
    say: "Typically you transfer the agreement to the buyer,\nor you may buy it out—depending on the contract.",
    why: "This is the #1 anxiety. Replace fear with a clear process.",
    verify: [
      "Transfer requirements + approval",
      "Transfer timeline + fees",
      "What happens if buyer declines"
    ]
  },
  {
    tag: "Roof",
    q: "What if the roof needs work later?",
    say: "Roof repairs are usually homeowner responsibility.\nIf panels must be removed/reinstalled, the contract says who pays.",
    why: "Roof questions are trust tests. Clear answers prevent cancellations.",
    verify: [
      "Remove/reinstall terms and fees",
      "Roof leak responsibility language",
      "How service is requested/scheduled"
    ]
  },
  {
    tag: "Service",
    q: "Who monitors and fixes the system?",
    say: "Usually the provider monitors production and covers repairs.\nIf performance drops, they schedule service.",
    why: "This is a major PPA advantage—homeowner doesn’t manage maintenance.",
    verify: [
      "Monitoring included",
      "Repair coverage + exclusions",
      "Service request process"
    ]
  },
  {
    tag: "Performance",
    q: "Is there a production guarantee?",
    say: "Some agreements include minimum production expectations.\nWe’ll point to the exact contract language together.",
    why: "Never promise guarantees verbally. Contract-backed clarity protects you and them.",
    verify: [
      "Any production guarantee/remedy language",
      "Measurement method/timeframe",
      "Exclusions (shade growth, weather, etc.)"
    ]
  },
  {
    tag: "NEM 3.0",
    q: "Why do batteries matter more now (NEM 3.0)?",
    say: "Exporting extra solar is worth less than it used to be.\nBatteries help you use more solar during expensive hours.",
    why: "This explains battery value in one clean sentence: control expensive time.",
    verify: [
      "Battery included or optional",
      "Backup vs self-consumption settings",
      "What loads are backed up"
    ]
  },
  {
    tag: "Outages",
    q: "Will solar work during a power outage?",
    say: "Most grid-tied solar shuts off during outages for safety.\nWith a battery and proper setup, selected circuits can stay on.",
    why: "Correct expectations = trust. This prevents the #1 outage misunderstanding.",
    verify: [
      "Backup equipment included",
      "Critical loads / backed-up circuits list",
      "Any backup subpanel scope"
    ]
  },
  {
    tag: "Trust",
    q: "What should I verify to avoid scams?",
    say: "Verify licensing, company roles, and everything that affects money in writing.\nWe review the contract together—line by line.",
    why: "Transparency lowers resistance and makes you the trusted guide.",
    verify: [
      "CSLB license and installer identity",
      "Fees/penalties section",
      "Escalator + transfer + buyout terms"
    ]
  },
  {
    tag: "Close",
    q: "What’s the simplest decision framework?",
    say: "If it lowers your cost per kWh, protects you from rising rates,\nand the contract terms feel clear—then it’s a smart move.",
    why: "People need permission to decide. This gives them a calm “yes/no” filter.",
    verify: [
      "Day-one savings expectation",
      "Escalator choice",
      "Home sale plan (transfer vs buyout)"
    ]
  }
];

/* =========================
   Render
   ========================= */
const cardEl = document.getElementById("card");
let idx = 0;

function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

function render(animInClass){
  const item = DECK[idx];
  const total = DECK.length;

  const dots = Array.from({length: Math.min(total, 10)}, (_,i)=>i)
    .map(i=>{
      // If more than 10 slides, show "window" around idx
      let base = 0;
      if(total > 10){
        base = clamp(idx - 4, 0, total - 10);
      }
      const real = (total > 10) ? (base + i) : i;
      const on = (real === idx) ? "on" : "";
      return `<span class="dot ${on}"></span>`;
    }).join("");

  const html = `
    <div class="topRow">
      <div class="progress">
        <span><b style="color:rgba(255,255,255,.92)">Question ${idx+1}</b> of ${total}</span>
        <span style="opacity:.65">•</span>
        <span style="color:rgba(251,201,9,.92)">${item.tag}</span>
      </div>
      <div class="dots" aria-hidden="true">${dots}</div>
    </div>

    <h1 class="qTitle">${escapeHtml(item.q)}</h1>

    <div class="say">
      <div class="label"><span class="chipDot"></span> Say this</div>
      <p>${escapeHtml(item.say).replace(/\n/g,"<br>")}</p>
    </div>

    <div class="actions">
      <button class="btn teal" id="whyBtn">
        <span>Why this works</span>
        <span class="hint">tap ▸</span>
      </button>
      <button class="btn gray" id="verifyBtn">
        <span>Verify in contract</span>
        <span class="hint">tap ▸</span>
      </button>
    </div>

    <div class="nav">
      <button class="navBtn" id="backBtn" ${idx===0 ? "disabled" : ""}>◀ Back</button>
      <button class="navBtn primary" id="nextBtn" ${idx===total-1 ? "disabled" : ""}>Next ▶</button>
    </div>
  `;

  cardEl.className = "card";
  if(animInClass) cardEl.classList.add(animInClass);
  cardEl.innerHTML = html;

  // Wire buttons
  document.getElementById("whyBtn").onclick = ()=> openSheet("Why this works", item.why, item);
  document.getElementById("verifyBtn").onclick = ()=> openSheet("Verify in contract", item.verify, item, true);

  document.getElementById("backBtn").onclick = ()=> go(-1);
  document.getElementById("nextBtn").onclick = ()=> go(1);
}

function go(delta){
  const total = DECK.length;
  const next = idx + delta;
  if(next < 0 || next >= total) return;

  // Animate out then in
  const outClass = delta > 0 ? "animOutLeft" : "animOutRight";
  const inClass  = delta > 0 ? "animInRight" : "animInLeft";

  cardEl.classList.remove("animInRight","animInLeft","animOutLeft","animOutRight");
  cardEl.classList.add(outClass);

  setTimeout(()=>{
    idx = next;
    render(inClass);
  }, 165);
}

/* =========================
   Swipe (Pointer Events)
   ========================= */
let startX = 0, startY = 0, dragging = false;

cardEl.addEventListener("pointerdown", (e)=>{
  // Ignore if a sheet is open
  if(document.getElementById("sheetBack").classList.contains("show")) return;
  dragging = true;
  startX = e.clientX;
  startY = e.clientY;
});

cardEl.addEventListener("pointerup", (e)=>{
  if(!dragging) return;
  dragging = false;
  const dx = e.clientX - startX;
  const dy = e.clientY - startY;

  // Only treat as swipe if mostly horizontal and passes threshold
  if(Math.abs(dx) > 55 && Math.abs(dx) > Math.abs(dy) * 1.2){
    if(dx < 0) go(1);   // swipe left -> next
    else go(-1);        // swipe right -> back
  }
});

/* =========================
   Bottom Sheet
   ========================= */
const sheetBack = document.getElementById("sheetBack");
const sheetTitle = document.getElementById("sheetTitle");
const sheetSub = document.getElementById("sheetSub");
const sheetBody = document.getElementById("sheetBody");
const sheetClose = document.getElementById("sheetClose");
const sheetTagLeft = document.getElementById("sheetTagLeft");
const sheetTagRight = document.getElementById("sheetTagRight");

function openSheet(title, content, item, isBullets=false){
  sheetTitle.textContent = title;
  sheetSub.textContent = item.q;

  if(isBullets){
    sheetBody.innerHTML = `
      <ul class="bullets">
        ${(content || []).map(x=> `<li>${escapeHtml(x)}</li>`).join("")}
      </ul>
    `;
  } else {
    sheetBody.innerHTML = `<div>${escapeHtml(content || "")}</div>`;
  }

  sheetTagLeft.textContent = `Category: ${item.tag}`;
  sheetTagRight.textContent = `Swipe: next/prev`;

  sheetBack.classList.add("show");
  sheetBack.setAttribute("aria-hidden","false");
}

function closeSheet(){
  sheetBack.classList.remove("show");
  sheetBack.setAttribute("aria-hidden","true");
}

sheetClose.onclick = closeSheet;
sheetBack.addEventListener("click", (e)=>{
  if(e.target === sheetBack) closeSheet();
});
window.addEventListener("keydown", (e)=>{
  if(e.key === "Escape") closeSheet();
  if(sheetBack.classList.contains("show")) return;
  if(e.key === "ArrowRight") go(1);
  if(e.key === "ArrowLeft") go(-1);
});

/* =========================
   Help Button
   ========================= */
document.getElementById("helpBtn").onclick = ()=>{
  openSheet(
    "How to use Learn Mode",
    "Use this like iPhone onboarding:\n\n• Read the “Say this” out loud.\n• Tap “Why” only if you need the reason.\n• Tap “Verify” only if you’re reviewing contract details.\n\nSwipe left/right to move through questions.\n\nPro tip: Reps should run this deck 1–2 times before knocking.",
    { q:"", tag:"Help" }
  );
};

/* =========================
   Utils
   ========================= */
function escapeHtml(str){
  return String(str ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* Init */
render();
</script>
</body>
</html>
